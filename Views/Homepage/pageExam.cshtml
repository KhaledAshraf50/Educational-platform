@using Luno_platform.Viewmodel

@model pageExam_viewmodel




@{
    Layout = "~/Views/Shared/_navbar.cshtml";
}

@section Styles {
    <link rel="stylesheet" href="~/assets/css/Exam.css" />
}

<div class="exam-container">

    <!-- Header يحتوي اسم الامتحان والوقت -->
    <div class="exam-header">
        <div>@Model.examinfo.ExamName</div>
        <div class="timer-box" id="timer">00:00</div>
    </div>

    <form method="post" action="/Exam/SubmitExam" id="examForm">
        <input type="hidden" name="ExamID" value="@Model.examinfo.ExamID" />

        @for (int i = 0; i < Model.questions.Count; i++)
        {
            var q = Model.questions[i];

            <div class="question-block">

                <h3 class="question-number">
                    السؤال @(i + 1)
                </h3>

                <p class="question-text">
                    @Html.Raw(q.questionText)
                </p>

                <div class="options-container">

                    <label class="option-item">
                        <input type="radio" name="Answers[@q.questionID]" value="@q.chooseA" /> @q.chooseA
                    </label>

                    <label class="option-item">
                        <input type="radio" name="Answers[@q.questionID]" value="@q.chooseB" /> @q.chooseB
                    </label>

                    <label class="option-item">
                        <input type="radio" name="Answers[@q.questionID]" value="@q.chooseC" /> @q.chooseC
                    </label>

                    <label class="option-item">
                        <input type="radio" name="Answers[@q.questionID]" value="@q.chooseD" /> @q.chooseD
                    </label>

                </div>

            </div>
        }

        <div class="submit-section">
            <button type="submit" class="save-btn">💾 تسليم الامتحان</button>
        </div>

    </form>

</div>

<script>
    // -------- TIMER -------- //
    let time = @Model.examinfo.Time * 60;
    const timer = document.getElementById("timer");

    function tick() {
        let m = Math.floor(time / 60);
        let s = time % 60;

        timer.textContent = `${m}:${s < 10 ? "0" : ""}${s}`;

        if (time <= 0) {
            document.getElementById("examForm").submit(); // Auto submit
            return;
        }

    // مؤقت الامتحان
    let time = @Model.examinfo.Time * 60;
    const timerEl = document.getElementById('timer');

    function updateTimer() {
        const m = Math.floor(time / 60);
        const s = time % 60;
        timerEl.textContent = `${m}:${s < 10 ? '0' : ''}${s}`;
        time--;
        setTimeout(tick, 1000);
    }
    updateTimer();


    tick();
</script>
