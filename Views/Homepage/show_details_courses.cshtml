@using Luno_platform.Viewmodel
@model detailscourse_viewmodel

@{
    Layout = "~/Views/Shared/_navbar.cshtml";
}

<link rel="stylesheet" href="~/assets/css/details_courses.css" />





<section class="course-details" style="margin-top: 100px;">
    <div class="container">

        @if (TempData["AlertMessage"] != null)
        {
            <div class="alert alert-warning" style="padding:12px; font-size:16px;">
                @TempData["AlertMessage"]
            </div>
        }
        <!-- هيدر -->
        <div class="course-header">
            <img src="@Url.Content(Model.Courses.Image)" alt="صورة الكورس" class="course-image" />
            <div class="course-info">
                <h1 class="course-title">@Model.Courses.CourseName</h1>
                <p class="course-teacher">
                    المدرس:
                    <span>@Model.Courses.Instructor.User.fname @Model.Courses.Instructor.User.lastName</span>
                </p>
                <p class="course-price"><i class="fa-solid fa-tag"></i> السعر: <span>@Model.Courses.price</span></p>

                @if (@Model.issubscrip)
                {
                    <button class="enroll-btn btn" disabled>
                        أنت مشترك بالفعل
                    </button>
                }
                else
                {
                    <form asp-controller="Payment" asp-action="Pay" method="post">
                        <input type="hidden" name="courseId" value="@Model.Courses.CourseId" />
                        <input type="hidden" name="amount" value="@Model.Courses.price" />
                        <button type="submit" class="enroll-btn btn">
                            اشترك الآن
                        </button>
                    </form>
                }

            </div>
        </div>

        <!-- الوصف -->
        <div class="course-description">
            <h2>عن الكورس</h2>
            <p>@Model.Courses.description</p>
        </div>

        <!-- المحتوى -->
        <div class="course_content">
            <h1 class="title mb-4">تفاصيل الكورس</h1>

            <div class="accordion" id="accordionLevel1">

                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button"
                                data-bs-toggle="collapse"
                                data-bs-target="#collapseContent"
                                aria-expanded="false" aria-controls="collapseContent">
                            المحتوى
                        </button>
                    </h2>

                    <!-- محتوى واحد فقط -->
                    <div id="collapseContent" class="accordion-collapse collapse" data-bs-parent="#accordionLevel1">
                        <div class="accordion-body">

                            @if (Model.Courses.CourseContent != null)
                            {
                                var locked = !Model.issubscrip;

                                <!-- Url1 -->
                                @if (!string.IsNullOrEmpty(Model.Courses.CourseContent.Url1))
                                {
                                    <div class="@(locked ? "desc_contentlock" : "desc_content")">
                                        <p>@Model.Courses.CourseContent.nameurl1</p>
                                        <a href="@Model.Courses.CourseContent.Url1" class="@(locked ? "locked-link" : "")">عرض</a>
                                    </div>
                                }

                                <!-- Url2 -->
                                @if (!string.IsNullOrEmpty(Model.Courses.CourseContent.Url2))
                                {
                                    <div class="@(locked ? "desc_contentlock" : "desc_content")">
                                        <p>@Model.Courses.CourseContent.nameurl2</p>
                                        <a href="@Model.Courses.CourseContent.Url2" class="@(locked ? "locked-link" : "")">عرض</a>
                                    </div>
                                }

                                <!-- Url3 -->
                                @if (!string.IsNullOrEmpty(Model.Courses.CourseContent.Url3))
                                {
                                    <div class="@(locked ? "desc_contentlock" : "desc_content")">
                                        <p>@Model.Courses.CourseContent.nameurl3</p>
                                        <a href="@Model.Courses.CourseContent.Url3" class="@(locked ? "locked-link" : "")">عرض</a>
                                    </div>
                                }

                                <!-- Exam -->
                                @if (Model.Courses.CourseContent.Exams != null)
                                {
                                    <div class="@(locked ? "desc_contentlock" : "desc_content")">
                                        <p>@Model.Courses.CourseContent.Exams.ExamName</p>
                                        <a href="/homepage/pageExam/@Model.Courses.CourseContent.Exams.ExamID/@Model.CourseID" 
                                           class="@(locked ? "locked-link" : "")">عرض</a>
                                    </div>
                                }

                                <!-- Task -->
                                @if (Model.Courses.CourseContent.Tasks != null)
                                {
                                    <div class="@(locked ? "desc_contentlock" : "desc_content")">
                                        <p>@Model.Courses.CourseContent.Tasks.TaskName</p>
                                        <a href="/homepage/pageTask/@Model.Courses.CourseContent.Tasks.TaskID/@Model.CourseID"
                                           class="@(locked ? "locked-link" : "")">عرض</a>
                                    </div>
                                }
                            }
                            else
                            {
                                <p>لا يوجد محتوى لهذا الكورس حتى الآن.</p>
                            }

                        </div>
                    </div>

                </div>

            </div>

        </div>

    </div>
</section>

<script>
    // مسح الرسالة
    setTimeout(() => {
        document.querySelectorAll(".alert").forEach(a => a.remove());
    }, 4000);

    // منع انتقال اللينكات المقفولة
    document.addEventListener("click", function (e) {
        if (e.target.classList.contains("locked-link")) {
            e.preventDefault();
        }
    });
</script>
